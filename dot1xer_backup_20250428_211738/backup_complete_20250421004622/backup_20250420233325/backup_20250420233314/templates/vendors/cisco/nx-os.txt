! Cisco NX-OS 802.1X and RADIUS Configuration
! Generated by Dot1Xer Supreme Enterprise Edition v4.2.0
! Vendor: Cisco
! Platform: NX-OS
! Version: {{platform-version}}

!=====================================================================
! GLOBAL SETTINGS
!=====================================================================
feature tacacs
feature ldap
feature dot1x
feature dhcp
feature lldp
feature aaa

! Clock configuration
clock timezone {{timezone}} {{timezone-offset}}
clock summer-time {{daylight-name}} {{summerOffset}} {{summerStart}} {{summerEnd}}

!=====================================================================
! TACACS+ CONFIGURATION
!=====================================================================
{{#useTacacs}}
! TACACS+ Servers
tacacs-server host {{tacacsServer1}} key {{tacacsKey1}} timeout {{tacacsTimeout}} port 49
{{#tacacsServer2}}
tacacs-server host {{tacacsServer2}} key {{tacacsKey2}} timeout {{tacacsTimeout}} port 49
{{/tacacsServer2}}

! TACACS+ Server Group
aaa group server tacacs+ TACACS-GROUP
 server {{tacacsServer1}}
{{#tacacsServer2}}
 server {{tacacsServer2}}
{{/tacacsServer2}}
 use-vrf {{tacacsVrf}}
 source-interface {{tacacsSourceInterface}}

! Device Administration Authentication
aaa authentication login default group TACACS-GROUP local
aaa authentication login console local
aaa authorization config-commands default group TACACS-GROUP local
aaa authorization commands default group TACACS-GROUP local
aaa accounting default group TACACS-GROUP
aaa authentication login error-enable

! Console Line
line console
 exec-timeout {{consoleTimeout}}
 login authentication console

! VTY Lines
line vty
 exec-timeout {{vtyTimeout}}
 login authentication default
 session-limit 15
{{/useTacacs}}

!=====================================================================
! AAA CONFIGURATION
!=====================================================================
aaa authentication dot1x default group RAD-SERVERS
{{#useLocalAuthFallback}}
aaa authentication dot1x FALLBACK group RAD-SERVERS local
{{/useLocalAuthFallback}}
aaa authorization network default group RAD-SERVERS
{{#enableAccounting}}
aaa accounting dot1x default group RAD-SERVERS
{{/enableAccounting}}

!=====================================================================
! RADIUS CONFIGURATION
!=====================================================================
! Primary RADIUS Server
radius-server host {{radiusServer1}} key {{radiusKey1}} auth-port {{radiusAuthPort1}} acct-port {{radiusAcctPort1}} timeout {{radiusTimeout}} retransmit {{radiusRetransmit}}
{{#radiusServer2}}
radius-server host {{radiusServer2}} key {{radiusKey2}} auth-port {{radiusAuthPort2}} acct-port {{radiusAcctPort2}} timeout {{radiusTimeout}} retransmit {{radiusRetransmit}}
{{/radiusServer2}}

! RADIUS Server Group
aaa group server radius RAD-SERVERS
 server {{radiusServer1}}
{{#radiusServer2}}
 server {{radiusServer2}}
{{/radiusServer2}}
 use-vrf {{radiusVrf}}
 source-interface {{radiusSourceInterface}}
 deadtime {{radiusDeadtime}}

{{#enableAccounting}}
radius-server directed-request
{{#accountingInterval}}
aaa accounting update periodic {{accountingInterval}}
{{/accountingInterval}}
{{/enableAccounting}}

!=====================================================================
! RADIUS CoA (CHANGE OF AUTHORIZATION) CONFIGURATION
!=====================================================================
{{#useCoa}}
aaa server radius dynamic-author
 client {{radiusServer1}} vrf {{radiusVrf}} server-key {{radiusKey1}}
{{#radiusServer2}}
 client {{radiusServer2}} vrf {{radiusVrf}} server-key {{radiusKey2}}
{{/radiusServer2}}
 port {{coaPort}}
 auth-type all
{{/useCoa}}

!=====================================================================
! 802.1X GLOBAL SETTINGS
!=====================================================================
dot1x system-auth-control
dot1x re-authentication
dot1x timeout quiet-period {{quietPeriod}}
dot1x timeout tx-period {{txPeriod}}
dot1x timeout re-authperiod {{reauthPeriod}}
dot1x max-req {{maxReauth}}
dot1x timeout supp-timeout 30

!=====================================================================
! DHCP SNOOPING CONFIGURATION
!=====================================================================
{{#enableDhcpSnooping}}
ip dhcp snooping
ip dhcp snooping vlan {{dhcpSnoopingVlans}}
{{#dhcpSnoopingOption82}}
ip dhcp snooping information option
{{/dhcpSnoopingOption82}}
{{/enableDhcpSnooping}}

!=====================================================================
! DYNAMIC ARP INSPECTION CONFIGURATION
!=====================================================================
{{#enableDai}}
ip arp inspection vlan {{daiVlans}}
ip arp inspection validate {{#daiValidateSrc}}src-mac{{/daiValidateSrc}} {{#daiValidateDst}}dst-mac{{/daiValidateDst}} {{#daiValidateIp}}ip{{/daiValidateIp}}
{{/enableDai}}

!=====================================================================
! IP SOURCE GUARD CONFIGURATION
!=====================================================================
{{#enableIpsg}}
ip source-guard
{{/enableIpsg}}

!=====================================================================
! INTERFACE CONFIGURATION
!=====================================================================
{{#interface}}
interface {{interface}}
 switchport mode access
 switchport access vlan {{vlanAuth}}
{{#vlanVoice}}
 switchport voice vlan {{vlanVoice}}
{{/vlanVoice}}
 switchport nonegotiate
 no switchport port-security
{{#enableDhcpSnooping}}
 ip dhcp snooping limit rate 100
{{/enableDhcpSnooping}}
{{#enableDai}}
 ip arp inspection limit rate 100
{{/enableDai}}
{{#enableIpsg}}
 ip verify source dhcp-snooping-vlan
{{/enableIpsg}}
{{#enableStormControl}}
 storm-control broadcast level {{stormControlBroadcast}}
 storm-control multicast level {{stormControlMulticast}}
 storm-control unicast level {{stormControlUnicast}}
 storm-control action {{stormControlAction}}
{{/enableStormControl}}
 spanning-tree port type edge
 spanning-tree bpduguard enable
 spanning-tree guard root
 
{{#enableDeviceSensor}}
 lldp transmit
 lldp receive
 cdp enable
{{/enableDeviceSensor}}

 ! 802.1X Interface Configuration
 dot1x pae authenticator
{{#authMode eq "open"}}
 dot1x port-control auto
{{/authMode}}
{{#authMode eq "closed"}}
 dot1x port-control force-authorized
{{/authMode}}
 dot1x timeout quiet-period {{quietPeriod}}
 dot1x timeout tx-period {{txPeriod}}
 dot1x timeout re-authperiod {{reauthPeriod}}
 dot1x max-req {{maxReauth}}
 dot1x host-mode {{hostMode}}

{{#authMethod eq "mab" or authMethod eq "dot1x-mab" or authMethod eq "concurrent"}}
 ! MAC Authentication Bypass
 mac-authentication
{{/authMethod}}
{{/interface}}
