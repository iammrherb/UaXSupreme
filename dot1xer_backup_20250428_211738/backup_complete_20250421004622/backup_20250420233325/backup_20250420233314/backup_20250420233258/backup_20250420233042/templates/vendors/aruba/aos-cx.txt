! Aruba AOS-CX 802.1X/RADIUS/TACACS+ Comprehensive Configuration
! Generated by Dot1Xer Supreme Enterprise Edition v4.2.0
! Vendor: Aruba
! Platform: AOS-CX
! Version: {{platform-version}}

!=====================================================================
! TACACS+ CONFIGURATION
!=====================================================================
{{#useTacacs}}
! TACACS+ Server Configuration
tacacs-server host {{tacacsServer1}} key {{tacacsKey1}}
{{#tacacsServer2}}
tacacs-server host {{tacacsServer2}} key {{tacacsKey2}}
{{/tacacsServer2}}

! TACACS+ Server Group
aaa server-group tacacs "tacacs-group"
 servers
  {{tacacsServer1}}
{{#tacacsServer2}}
  {{tacacsServer2}}
{{/tacacsServer2}}

! AAA Authentication for Console and Management
aaa authentication login default group tacacs-group local
aaa authentication login console local
aaa authorization commands default group tacacs-group local
aaa accounting commands default group tacacs-group

! Console Configuration
console baud-rate {{consoleBaudRate}}
console idle-timeout {{consoleTimeout}}
{{/useTacacs}}

!=====================================================================
! RADIUS SERVER CONFIGURATION
!=====================================================================
! Primary RADIUS Server
radius-server host {{radiusServer1}} key {{radiusKey1}}
{{#radiusServer2}}
radius-server host {{radiusServer2}} key {{radiusKey2}}
{{/radiusServer2}}

! RADIUS Server Group for 802.1X
aaa server-group radius "dot1x-radius"
 servers
  {{radiusServer1}}
{{#radiusServer2}}
  {{radiusServer2}}
{{/radiusServer2}}

!=====================================================================
! AAA AUTHENTICATION CONFIGURATION
!=====================================================================
aaa authentication port-access dot1x authenticator radius-server-group "dot1x-radius"
{{#enableAccounting}}
aaa accounting port-access dot1x start-stop radius-server-group "dot1x-radius"
{{#accountingInterval}}
aaa accounting update periodic {{accountingInterval}}
{{/accountingInterval}}
{{/enableAccounting}}

!=====================================================================
! 802.1X GLOBAL SETTINGS
!=====================================================================
aaa authentication port-access dot1x authenticator cached-reauth {{reauthPeriod}}
aaa authentication port-access dot1x authenticator tx-period {{txPeriod}}
aaa authentication port-access dot1x authenticator quiet-period {{quietPeriod}}
aaa authentication port-access dot1x authenticator max-requests {{maxReauth}}

{{#vlanGuest}}
aaa authentication port-access dot1x authenticator guest-vlan {{vlanGuest}}
{{/vlanGuest}}

{{#vlanUnauth}}
aaa authentication port-access dot1x authenticator auth-fail-vlan {{vlanUnauth}}
{{/vlanUnauth}}

{{#vlanCritical}}
aaa authentication port-access dot1x authenticator critical-vlan {{vlanCritical}}
{{/vlanCritical}}

!=====================================================================
! RADIUS DYNAMIC AUTHORIZATION (CoA)
!=====================================================================
{{#useCoa}}
aaa authorization port-access dot1x radius-attributes all
{{/useCoa}}

!=====================================================================
! ADVANCED RADIUS OPTIONS
!=====================================================================
{{#useRadsec}}
! RadSec Configuration
radius-server host {{radiusServer1}} tls-port {{radsecPort}}
radius-server host {{radiusServer1}} tls servercert {{radsecServerCert}}
radius-server host {{radiusServer1}} tls clientcert {{radsecClientCert}}
radius-server host {{radiusServer1}} tls key {{radsecClientKey}}
{{/useRadsec}}

!=====================================================================
! DHCP SNOOPING CONFIGURATION
!=====================================================================
{{#enableDhcpSnooping}}
dhcp-snooping
dhcp-snooping vlan {{dhcpSnoopingVlans}}
{{#dhcpSnoopingOption82}}
dhcp-snooping option 82
{{/dhcpSnoopingOption82}}
{{/enableDhcpSnooping}}

!=====================================================================
! DYNAMIC ARP INSPECTION CONFIGURATION
!=====================================================================
{{#enableDai}}
arp-protect
arp-protect vlan {{daiVlans}}
{{/enableDai}}

!=====================================================================
! IP SOURCE GUARD CONFIGURATION
!=====================================================================
{{#enableIpsg}}
ip source-guard
{{/enableIpsg}}

!=====================================================================
! INTERFACE CONFIGURATION
!=====================================================================
{{#interface}}
interface {{interface}}
 no routing
 vlan access {{vlanAuth}}
{{#vlanVoice}}
 vlan voice {{vlanVoice}}
{{/vlanVoice}}
 
{{#enableDhcpSnooping}}
 dhcp-snooping trust
{{/enableDhcpSnooping}}

{{#enableDai}}
 arp-protect trust
{{/enableDai}}

{{#enableStormControl}}
 storm-control broadcast {{stormControlBroadcast}}
 storm-control multicast {{stormControlMulticast}}
 storm-control unicast {{stormControlUnicast}}
 storm-control action {{stormControlAction}}
{{/enableStormControl}}

 spanning-tree port-type admin-edge
 spanning-tree bpdu-guard
 spanning-tree root-guard

 ! 802.1X Configuration
 aaa authentication port-access dot1x authenticator enable
 aaa authentication port-access dot1x authenticator port-control {{#authMode eq "open"}}auto{{/authMode}}{{#authMode eq "closed"}}force-authorized{{/authMode}}
 aaa authentication port-access dot1x authenticator host-mode {{#hostMode eq "multi-auth"}}multi{{/hostMode}}{{#hostMode eq "multi-domain"}}multi-domain{{/hostMode}}{{#hostMode eq "single-host"}}single{{/hostMode}}{{#hostMode eq "multi-host"}}multi{{/hostMode}}

{{#authMethod eq "mab"}}
 ! MAB configuration
 aaa authentication port-access mac-auth enable
 no aaa authentication port-access dot1x authenticator enable
{{/authMethod}}

{{#authMethod eq "dot1x-mab"}}
 ! 802.1X with MAB fallback
 aaa authentication port-access mac-auth enable
 aaa authentication port-access mac-auth radius-server-group "dot1x-radius"
 aaa authentication port-access auth-order dot1x mac-auth
{{/authMethod}}

{{#authMethod eq "concurrent"}}
 ! 802.1X and MAB concurrent
 aaa authentication port-access mac-auth enable
 aaa authentication port-access mac-auth radius-server-group "dot1x-radius"
 aaa authentication port-access auth-order dot1x_mac-auth
{{/authMethod}}

{{#enablePortSecurity}}
 ! Port security
 port-security
 port-security maximum {{portSecurityMaxMac}}
 port-security violation {{#portSecurityViolation eq "protect"}}restrict{{/portSecurityViolation}}{{#portSecurityViolation eq "restrict"}}restrict{{/portSecurityViolation}}{{#portSecurityViolation eq "shutdown"}}shutdown{{/portSecurityViolation}}
{{/enablePortSecurity}}
{{/interface}}

{{#interfaceRange}}
! For interface range {{interfaceRange}}
! Apply the same configuration as shown for {{interface}}
{{/interfaceRange}}

! End of configuration
