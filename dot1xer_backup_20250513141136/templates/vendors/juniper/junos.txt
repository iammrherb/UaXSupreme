# Juniper JunOS 802.1X/RADIUS/TACACS+ Configuration
# Generated by Dot1Xer Supreme Enterprise Edition v4.2.0
# Vendor: Juniper
# Platform: JunOS
# Version: {{platform-version}}

#=====================================================================
# SYSTEM CONFIGURATION
#=====================================================================
set system host-name {{hostname}}
set system domain-name {{domain}}
set system time-zone {{timezone}}

#=====================================================================
# TACACS+ CONFIGURATION
#=====================================================================
{{#useTacacs}}
# TACACS+ Server Configuration
set system tacplus-server {{tacacsServer1}} secret {{tacacsKey1}}
set system tacplus-server {{tacacsServer1}} timeout {{tacacsTimeout}}
set system tacplus-server {{tacacsServer1}} port 49
set system tacplus-server {{tacacsServer1}} single-connection
{{#tacacsServer2}}
set system tacplus-server {{tacacsServer2}} secret {{tacacsKey2}}
set system tacplus-server {{tacacsServer2}} timeout {{tacacsTimeout}}
set system tacplus-server {{tacacsServer2}} port 49
set system tacplus-server {{tacacsServer2}} single-connection
{{/tacacsServer2}}

# TACACS+ Authentication
set system authentication-order [ tacplus password ]
set system tacplus-options service-name junos-exec
set system accounting destination tacplus
set system accounting events [ login change-log interactive-commands ]
{{/useTacacs}}

#=====================================================================
# RADIUS CONFIGURATION
#=====================================================================
# RADIUS Server Configuration
set access radius-server {{radiusServer1}} secret {{radiusKey1}}
set access radius-server {{radiusServer1}} timeout {{radiusTimeout}}
set access radius-server {{radiusServer1}} retry {{radiusRetransmit}}
set access radius-server {{radiusServer1}} port {{radiusAuthPort1}}
set access radius-server {{radiusServer1}} accounting-port {{radiusAcctPort1}}
set access radius-server {{radiusServer1}} source-address {{radiusSourceIp}}
{{#radiusServer2}}
set access radius-server {{radiusServer2}} secret {{radiusKey2}}
set access radius-server {{radiusServer2}} timeout {{radiusTimeout}}
set access radius-server {{radiusServer2}} retry {{radiusRetransmit}}
set access radius-server {{radiusServer2}} port {{radiusAuthPort2}}
set access radius-server {{radiusServer2}} accounting-port {{radiusAcctPort2}}
set access radius-server {{radiusServer2}} source-address {{radiusSourceIp}}
{{/radiusServer2}}

# RADIUS Profile
set access profile dot1x-profile authentication-order radius
set access profile dot1x-profile radius authentication-server {{radiusServer1}}
{{#radiusServer2}}
set access profile dot1x-profile radius authentication-server {{radiusServer2}}
{{/radiusServer2}}
set access profile dot1x-profile radius options nas-identifier "{{radiusNasId}}"
set access profile dot1x-profile radius options nas-port-type ethernet
set access profile dot1x-profile radius options interface-description-format interface-description

# RADIUS Dynamic Authorization (CoA)
{{#useCoa}}
set access profile dot1x-profile radius options dynamic-request-port {{coaPort}}
{{/useCoa}}

# RADIUS Accounting
{{#enableAccounting}}
set access profile dot1x-profile accounting-order radius
set access profile dot1x-profile radius accounting-server {{radiusServer1}}
{{#radiusServer2}}
set access profile dot1x-profile radius accounting-server {{radiusServer2}}
{{/radiusServer2}}
set access profile dot1x-profile radius options accounting-session-id-format decimal
set access profile dot1x-profile radius options accounting-interim-interval {{accountingInterval}}
{{/enableAccounting}}

#=====================================================================
# 802.1X CONFIGURATION
#=====================================================================
# Global 802.1X
set protocols dot1x authenticator authentication-profile-name dot1x-profile

# Global 802.1X Settings
set protocols dot1x authenticator reauthentication {{reauthPeriod}}
set protocols dot1x authenticator quiet-period {{quietPeriod}}
set protocols dot1x authenticator transmit-period {{txPeriod}}
set protocols dot1x authenticator maximum-requests {{maxReauth}}

# VLAN Configuration
{{#vlanGuest}}
set protocols dot1x authenticator guest-vlan {{vlanGuest}}
{{/vlanGuest}}
{{#vlanUnauth}}
set protocols dot1x authenticator server-reject-vlan {{vlanUnauth}}
{{/vlanUnauth}}
{{#vlanCritical}}
set protocols dot1x authenticator server-fail vlan-name {{vlanCritical}}
{{/vlanCritical}}

#=====================================================================
# SECURITY FEATURES
#=====================================================================
{{#enableDhcpSnooping}}
# DHCP Snooping
set forwarding-options dhcp-security group profile-group-1 interface {{interface}} overrides
set forwarding-options dhcp-security group profile-group-1 overrides trust
set forwarding-options dhcp-security group profile-group-1 interface {{interface}} host-fast-path
set forwarding-options dhcp-security group profile-group-1 interface {{interface}} rate-limiting

# DHCP Option 82
{{#dhcpSnoopingOption82}}
set forwarding-options dhcp-security group profile-group-1 overrides relay-agent-option
{{/dhcpSnoopingOption82}}
{{/enableDhcpSnooping}}

{{#enableDai}}
# Dynamic ARP Inspection
set vlans vlan-{{vlanAuth}} forwarding-options dhcp-security arp-inspection
{{/enableDai}}

{{#enableIpsg}}
# IP Source Guard
set vlans vlan-{{vlanAuth}} forwarding-options dhcp-security ip-source-guard
{{/enableIpsg}}

{{#enableStormControl}}
# Storm Control
set interfaces {{interface}} unit 0 family ethernet-switching storm-control {{stormControlAction}} level {{stormControlLevel}}
{{/enableStormControl}}

#=====================================================================
# INTERFACE CONFIGURATION
#=====================================================================
{{#interface}}
# Interface Configuration
set interfaces {{interface}} unit 0 family ethernet-switching port-mode access
set interfaces {{interface}} unit 0 family ethernet-switching vlan members vlan-{{vlanAuth}}
{{#vlanVoice}}
set interfaces {{interface}} unit 0 family ethernet-switching vlan members vlan-{{vlanVoice}}
{{/vlanVoice}}

# Spanning Tree Configuration
set protocols rstp interface {{interface}} edge
set protocols rstp interface {{interface}} bpdu-block-on-edge
set protocols rstp interface {{interface}} no-root-port

# 802.1X Interface Configuration
set protocols dot1x authenticator interface {{interface}} supplicant {{#hostMode eq "multi-auth"}}multiple{{/hostMode}}{{#hostMode eq "multi-domain"}}multiple{{/hostMode}}{{#hostMode eq "single-host"}}single{{/hostMode}}{{#hostMode eq "multi-host"}}multiple{{/hostMode}}
set protocols dot1x authenticator interface {{interface}} quiet-period {{quietPeriod}}
set protocols dot1x authenticator interface {{interface}} transmit-period {{txPeriod}}
set protocols dot1x authenticator interface {{interface}} maximum-requests {{maxReauth}}
set protocols dot1x authenticator interface {{interface}} reauthentication {{reauthPeriod}}

{{#authMode eq "open"}}
# Monitor Mode (Open Authentication)
set protocols dot1x authenticator interface {{interface}} mac-radius restrict
{{/authMode}}

{{#authMode eq "closed"}}
# Closed Mode (Enforced Authentication)
set protocols dot1x authenticator interface {{interface}} supplicant-timeout 30
set protocols dot1x authenticator interface {{interface}} server-timeout 30
set protocols dot1x authenticator interface {{interface}} server-fail deny
{{/authMode}}

{{#authMethod eq "mab"}}
# MAC Authentication Bypass
set protocols dot1x authenticator interface {{interface}} mac-radius
set protocols dot1x authenticator interface {{interface}} mac-radius format global
{{/authMethod}}

{{#authMethod eq "dot1x-mab"}}
# 802.1X with MAC Authentication Bypass Fallback
set protocols dot1x authenticator interface {{interface}} mac-radius
set protocols dot1x authenticator interface {{interface}} mac-radius format global
set protocols dot1x authenticator interface {{interface}} supplicant multiple
{{/authMethod}}

{{#authMethod eq "concurrent"}}
# Concurrent 802.1X and MAC Authentication
set protocols dot1x authenticator interface {{interface}} mac-radius
set protocols dot1x authenticator interface {{interface}} mac-radius format global
set protocols dot1x authenticator interface {{interface}} supplicant multiple
set protocols dot1x authenticator interface {{interface}} eapol-block
{{/authMethod}}
{{/interface}}

# End of configuration
